name: Version Specs

on:
  push:
    tags:
      - 'cardano-ledger-spec-[0-9]+.[0-9]+.[0-9]+'

jobs:
  push-docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: cachix/install-nix-action@v15
        with:
          nix_path: nixpkgs=channel:nixos-unstable
          extra_nix_config: |
            trusted-public-keys = hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ= cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=
            substituters = https://hydra.iohk.io https://cache.nixos.org/
      - name: Build specs
        run: nix-build -A specs -o output/spec
      - name: Push docs to another repository
        uses: cpina/github-action-push-to-another-repository@v1.4.2
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source-directory: output
          destination-github-username: teodanciu
          destination-repository-name: docs-experiments
          user-email: teo.danciu@gmail.com
          commit-message: "Add docs for version ${{github.ref_name}}"
          target-directory: docs-${{github.ref_name}}
